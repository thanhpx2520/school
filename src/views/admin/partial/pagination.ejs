<div class="mx-5 mb-4 mt-3 d-flex justify-content-end">
  <div class="row">
    <div class="col">
      <nav aria-label="Page navigation">
        <ul class="pagination">
          <% if (data?.pages?.totalPages >= 1) {
                const { pages } = data;
                const currentPage = pages.currentPage;
                const totalPages = pages.totalPages;

                // Hàm build query param cho url
                const buildQuery = (extraParams = {}) => {
                  const mergedParams = { ...query, ...extraParams };
                  const queryString = Object.entries(mergedParams)
                    .filter(([k, v]) => v != null && v !== '')
                    .map(([k, v]) => {
                      if (Array.isArray(v)) {
                        return v.map(val => `${k}=${encodeURIComponent(val)}`).join('&');
                      }
                      return `${k}=${encodeURIComponent(v)}`;
                    })
                    .join('&');
                  return '?' + queryString;
                };

                // Hàm tạo mảng các trang cần hiển thị (tối đa 5 trang: currentPage -2 đến currentPage +2)
                const pageNumbers = [];
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, currentPage + 2);

                // Nếu đang ở gần đầu, đảm bảo đủ 5 trang nếu có thể
                if (currentPage <= 3) {
                  endPage = Math.min(5, totalPages);
                }
                // Nếu đang ở gần cuối, đảm bảo đủ 5 trang nếu có thể
                if (currentPage > totalPages - 3) {
                  startPage = Math.max(1, totalPages - 4);
                }

                for (let i = startPage; i <= endPage; i++) {
                  pageNumbers.push(i);
                }
          %>

          <!-- Nút Trang đầu -->
          <% if (currentPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="<%= buildQuery({ page: 1 }) %>">Đầu</a>
            </li>
          <% } else { %>
            <li class="page-item disabled"><span class="page-link">Đầu</span></li>
          <% } %>

          <!-- Nút Trang trước -->
          <% if (currentPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="<%= buildQuery({ page: currentPage - 1 }) %>">&laquo;</a>
            </li>
          <% } else { %>
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
          <% } %>

          <!-- Dấu ... trước -->
          <% if (startPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="<%= buildQuery({ page: 1 }) %>">1</a>
            </li>
            <% if (startPage > 2) { %>
              <li class="page-item disabled"><span class="page-link">...</span></li>
            <% } %>
          <% } %>

          <!-- Các số trang -->
          <% pageNumbers.forEach(i => { %>
            <li class="page-item <%= i === currentPage ? 'active' : '' %>">
              <% if (i === currentPage) { %>
                <span class="page-link"><%= i %></span>
              <% } else { %>
                <a class="page-link" href="<%= buildQuery({ page: i }) %>"><%= i %></a>
              <% } %>
            </li>
          <% }); %>

          <!-- Dấu ... sau -->
          <% if (endPage < totalPages) { %>
            <% if (endPage < totalPages - 1) { %>
              <li class="page-item disabled"><span class="page-link">...</span></li>
            <% } %>
            <li class="page-item">
              <a class="page-link" href="<%= buildQuery({ page: totalPages }) %>"><%= totalPages %></a>
            </li>
          <% } %>

          <!-- Nút Trang sau -->
          <% if (currentPage < totalPages) { %>
            <li class="page-item">
              <a class="page-link" href="<%= buildQuery({ page: currentPage + 1 }) %>">&raquo;</a>
            </li>
          <% } else { %>
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
          <% } %>

          <!-- Nút Trang cuối -->
          <% if (currentPage < totalPages) { %>
            <li class="page-item">
              <a class="page-link" href="<%= buildQuery({ page: totalPages }) %>">Cuối</a>
            </li>
          <% } else { %>
            <li class="page-item disabled"><span class="page-link">Cuối</span></li>
          <% } %>

          <% } %>
        </ul>
      </nav>
    </div>
  </div>
</div>
